---
layout: post
title:  "浏览器的最大连接"
date:   2016-11-14
author: 梁龙飞
tags: 编程
---

## 场景

项目中性能相关的日志绑定到组件的生命周期，一瞬间渲染多个组件会发出非常多的日志请求。也是大意，因为日志请求与其他数据请求不同域，就觉得没有问题。然后上线之后，主要的数据请求竟然出现了排队的现象。原因是瞬间的log达到上百条，经过一翻查找，原来浏览器并发连接是有限制的，而且一般不超过15个。——这个很久之前看过一篇文章，但是忘记了。所以这里再详细地记录下这个问题。


## 相关数据

<img src="/image/ua_connections.png" >

这个数据来源于 [http://www.browserscope.org/?category=network&v=top](http://www.browserscope.org/?category=network&v=top)

浏览器对每个域名的并发基本是个位数，无关域名的并发也不大。

## 针对此特性的性能优化

这节是凑字数的，因为仅仅是记录上面那些这篇文章未免太短小了。

### css spirit

雪碧图和js/css合并请求一样，将资源合并，一条请求搞定，不仅减少了占用浏览器的并发请求，而且也节省了带宽 —— 因为每个请求的建联也是非常可观的消耗。

### js/css combine

在上面说过了，略。

### load imgs on demand

这个技术是前端必备了，就是开始的时候img的src是空的，不加载图片。当此图片滚动到可视区域时（或者其他情景，反正就是这个图片需要展示了），再给它当年没给的真实src。
同时也指按设备、网络的情况下加载不同清晰度的图片。

## 减少网络请求数据量的优化

### 浏览器缓存

详见[浏览器缓存策略](/2016/11/04/cache-control.html)

### cookie-free domain

这是个新的约定。简单来讲就是向此域名请求静态资源时，不带cookie。—— 对的，在巨大的访问量下，做优化的前辈们真是做到了极致，搞得我都想提议把 http:// 中的两个斜杠去掉了。

### 资源压缩

极尽所有的压缩能力，js/css开发完uglify一次，传输的时候再开个gzip什么的。